# Variables - customize these before running
storage_accounts=("storageaccount1" "storageaccount2" "storageaccount3" ...) # Add all 60 storage account names
resource_group="target-rg"           # Resource group for private endpoints
vnet_name="target-vnet"              # VNet for private endpoints
subnet_name="private-endpoints-subnet" # Subnet for private endpoints
location="eastus"                    # Location for resources
target_subscription="TARGET_SUBSCRIPTION_ID" # Subscription for private endpoints
source_subscription="SOURCE_SUBSCRIPTION_ID" # Subscription where storage accounts exist
links_to_create=60 # Number of cross-subscription private endpoints to create

# Login and set subscriptions
az login

# Loop through storage accounts and create private endpoints
for i in {1..links_to_create}
do
    sa="StorageAccount${i}"
    echo "Processing storage account: $sa"

    # Get storage account resource ID from source subscription
    storage_id=$(az storage account show \
        --name $sa \
        --subscription $source_subscription \
        --query id -o tsv)

    # Create private endpoint in target subscription
    az account set --subscription $target_subscription

    az network private-endpoint create \
        --name "${sa}-pe" \
        --resource-group $resource_group \
        --vnet-name $vnet_name \
        --subnet $subnet_name \
        --private-connection-resource-id $storage_id \
        --group-id "blob" \
        --connection-name "${sa}-pe-conn" \
        --location $location

    # Optionally, approve the connection if required
done